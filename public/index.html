<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>misinfo</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  </head>
  <body>
    <form action="">
      <div class="row">
        <div class="col-4">
          <div class="list-group" id="list-tab" role="tablist">
            <a class="list-group-item list-group-item-action active" id="list-home-list" data-toggle="list" href="#list-home" role="tab" aria-controls="home">1st choice</a>
            <a class="list-group-item list-group-item-action" id="list-profile-list" data-toggle="list" href="#list-profile" role="tab" aria-controls="profile">2nd choice</a>
            <a class="list-group-item list-group-item-action" id="list-messages-list" data-toggle="list" href="#list-messages" role="tab" aria-controls="messages">3rd choice</a>
            <a class="list-group-item list-group-item-action" id="list-settings-list" data-toggle="list" href="#list-settings" role="tab" aria-controls="settings">4th choice</a>
          </div>
          <div>
            <button type="submit" class="btn btn-primary">Submit</button>
          </div>
        </div>
      </div>
    </form>

    <h4>submission updates:</h4>
    <p id="submissionsCount">
    </p>

    <h4>online:</h4>
    <p id="participants">
    </p>

    <h4>round submissions:</h4>
    <p id="roundSubmissions">
    </p>

    <h4>next choices:</h4>
    <p id="nextChoices">
    </p>

    <h4>poll results:</h4>
    <p id="results">
    </p>


    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();
      $('form').on('submit', function(){
        var responses = [];
        $('#list-tab').children('.active').each(function(index){
          responses.push($(this).text());
        })
        socket.emit('submission', responses);
        return false;
      })

      socket.on('connect', function(){
        console.log('a user has connected');
      })

      socket.on('participantUpdate', function(msg){
        $('#participants').text(`${msg}`);
      })

      socket.on('submissionsCount', function(msg){
        $('#submissionsCount').append(`<div>${msg}</div>`);
        // $('#submissions').append($('<li>').text(msg));
      })

      socket.on('allSubmissions', function(input){
        console.log(input['roundSubmissionsArray']);
        var nextChoices = input['roundSubmissionsArray'].filter(function(value, index, arr){return value != input['roundSubmissions'][socket.id]});
        $('#roundSubmissions').text(`round submissions: ${input['roundSubmissionsArray']}`);
        $('#nextChoices').text(`next choices: ${nextChoices}`);
      })

      socket.on('pollClosing', function(results){
        $('#results').text(`Poll results: ${results}`);
      })

    </script>
  </body>
</html>
